import yaml

from data.cve import CVEDataset
from index import HFSTIndex


DATASETS = dict(cve=CVEDataset)
INDEXES = dict(hfst=HFSTIndex)

with open("config/private.yaml", "r") as f:
    private = yaml.safe_load(f)

with open("config/cve.yaml", "r") as f:
    config = yaml.safe_load(f)

dataset = DATASETS[config["data"]["name"]](
    api_key=private["nvd_api_key"],
    **config["data"]["args"],
)

data_index = INDEXES[config["index"]["name"]](
    dataset,
    **config["index"]["init_args"],
)

# queries are strings or a list of strings
queries = [
    "injection vulnerability allowing attackers to execute arbitrary commands",
    "allowing attackers to invoke exposed public JIRA methods",
]

# default index score is L2 distance, hence lower means closer
searches, scores = data_index.semantic_search(queries, **config["index"]["search_args"])
